{% extends 'base.html' %}
{% load staticfiles %}

{% block title %} Edit Booking {% endblock %}
        
{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/style-table.css' %}" />
    <link rel="stylesheet" href="{% static 'css/style-edit-table.css' %}" />

{% endblock %}
        
{% block content %}
<br>
    <div id="filter-date" class="container col-12">
            <div class="row">
        
                <div class="col">
                    <form name="agent-transport-filter-sort" method="GET" action="{% url 'agent-transport-edit' %}" class="form-inline">
                        {% csrf_token %}
                        <div class="input-group">
                                <div class="input-group-prepend">
                                    <select name="filter_by" class="btn" style="background-color: #CED4DA;">
                                        <option value="date" class="bg-white">Date</option>
                                        <option value="month" class="bg-white" {% if filter_by == 'month' %}selected{% endif %}>Month</option>
                                    </select>
        
                                </div>
        
                            {% if filter_by == 'month' %}
                                <input id="id_date" name="date_filter" type="month" class="form-control mr-2" value="{{ date_filter }}">
                            {% else %}
                                <input id="id_date" name="date_filter" type="date" class="form-control mr-2" value="{{ date_filter }}">
                            {% endif %}
        
                        </div>
        
                        <button type="submit" class="btn btn-primary">OK</button>
                    </form>
                </div>
        
                <div class="col text-right">
                        {% for message in messages %}
                            <div class="save-msg mr-2 pt-2 text-secondary d-inline"><i class="fa fa-spinner fa-pulse"></i>&nbsp;{{ message }}</div>
                        {% endfor %}
        
                        <button class="btn btn-danger mr-1" onclick="document.forms['TableFilter'].submit();"><i class="fa fa-sign-out"></i>&nbsp;Exit</button>
               <form id="TableFilter" method="GET" action="{% url 'agent-transport-table' %}" style="display:none;">
                   <input type="hidden" name="date_filter" value="{{ date_filter }}">
                   <input type="hidden" name="filter_by" value="{{ filter_by }}">
               </form>
               <button class="btn btn-success" onclick="document.forms['edit-form'].submit();"><i class="fa fa-save"></i>&nbsp;Save</button>
                        
        
                </div>
                </div>
        
    </div>
        {% if agent_transports %}
            <div id='table-cont' class="table-cont table-responsive"> 
        <table class="table-hover">
            <thead class="text-nowrap bg-lightgray">
                <th>STATUS</th>
                <th>DATE</th>
                <th class="px-4">PRINCIPAL</th>
                <th class="px-4">SHIPPER</th>
                <th class="px-5">AGENT</th>
                <th>SIZE</th>
                <th class="px-4">BOOKING</th>

                <th>TR</th>
                <th>FM</th>
                <th>TR</th>
                <th>TO</th>

                <th class="px-3">CONTAINER 1</th>
                <th class="px-3">CONTAINER 2</th>

                <th class="px-5">REF.</th>
                <th class="px-5">REMARK</th>
                <th class="px-4">เลขที่ใบงาน</th>

            </thead> 
            <tbody> 
                <form id="edit-form" method="POST" action="{% url 'agent-transport-edit-save' %}">
                    {% csrf_token %}
                    <input type="hidden" name="date_filter" value="{{ date_filter }}">
                    <input type="hidden" name="filter_by" value="{{ filter_by }}">    
                {% for agent_transport in agent_transports %}
                    <form name="edit-form{{ agent_transport.pk }}" method="POST" action="{% url 'agent-transport-edit-save' %}">
                        {% csrf_token %}
                    <input type="hidden" name="pk" value="{{ agent_transport.pk }}">
                    
                    {% if agent_transport.status == '0' %}
                        <tr class="bg-secondary">
                    {% elif agent_transport.status == '1' %}
                        <tr class="alert-warning">
                    {% else %}
                        <tr>
                    {% endif %}
                        <td>
                            <select name="status" class="custom-select status py-1 px-2">
                                <option value="1" {% if agent_transport.status == '1' %}selected{% endif %}> - </option>
                                <option value="2" {% if agent_transport.status == '2' %}selected{% endif %}> Finished </option>
                                <option value="0" {% if agent_transport.status == '0' %}selected{% endif %}> Cancel </option>
                            </select>
                        </td>
                        <td><input type="date" name="date" class="form-control" value="{{ agent_transport.date | date:'Y-m-d' }}"  autocomplete=off></td>
                        <td class="text-center px-2"><div class="long-text">{{ agent_transport.principal }}</div></td>
                        <td style="min-width:250px;">{{ agent_transport.shipper }}</td>
                        <td><input name="agent" class="form-control" value="{{ agent_transport.agent }}" maxlength="50" autocomplete=off></td>
                        <td>
                            <select name="size" class="custom-select size">
                                <option value="" {% if agent_transport.size == "" %}selected{% endif %}> -------- </option>
                                <option value="20'" {% if agent_transport.size == "20'" %}selected{% endif %}>20'</option>
                                <option value="20'RF" {% if agent_transport.size == "20'RF" %}selected{% endif %}>20'RF</option>
                                <option value="40'" {% if agent_transport.size == "40'" %}selected{% endif %}>40'</option>
                                <option value="40'HC" {% if agent_transport.size == "40'HC" %}selected{% endif %}>40'HC</option>
                                <option value="40'OT" {% if agent_transport.size == "40'OT" %}selected{% endif %}>40'OT</option>
                                <option value="40'GOH" {% if agent_transport.size == "40'GOH" %}selected{% endif %}>40'GOH</option>
                                <option value="40'RF" {% if agent_transport.size == "40'RF" %}selected{% endif %}>40'RF</option>
                                <option value="45'" {% if agent_transport.size == "45'" %}selected{% endif %}>45'</option>
                                <option value="" disabled> -------- </option>
                                <option value="2X20'" {% if agent_transport.size == "2X20'" %}selected{% endif %}>2X20'</option>
                                <option value="2X20'RF" {% if agent_transport.size == "2X20'RF" %}selected{% endif %}>2X20'RF</option>
                            </select>
                        </td>
                        {% if agent_transport.status == '0' %}
                            <td class="bg-secondary text-center" style="min-width:150px;">
                        {% else %}
                            <td style="min-width:150px; background-color:
                            {% ifchanged agent_transport.booking_no %}
                                {% cycle "#9977b4" "#dd86b9" "#f497a9" "#f9b489" "#fdcd79" "#fff68f" "#b6d884" "#81cbb5" "#6acade" "#72abdd" as rowcolors %}
                            {% else %}
                                {{ rowcolors }}
                            {% endifchanged %}">
                        {% endif %}
                            <input name="booking_no" class="form-control" value="{{ agent_transport.booking_no }}" maxlength="50" autocomplete=off>
                            </td>

                        <td class="{% if agent_transport.status == '0' %}bg-secondary{% elif agent_transport.status == '2' %}bg-lime{% elif agent_transport.pickup_tr %}bg-cyan{% else %}{% endif %}">
                            <input name="pickup_tr" class="form-control" value="{{ agent_transport.pickup_tr }}" maxlength="15" autocomplete=off>
                        </td>
                        <td><input name="pickup_from" class="form-control" value="{{ agent_transport.pickup_from }}" maxlength="20" autocomplete=off></td>
                        <td class="{% if agent_transport.status == '0' %}bg-secondary{% elif agent_transport.status == '2' %}bg-lime{% elif agent_transport.return_tr %}bg-cyan{% else %}{% endif %}">
                            <input name="return_tr" class="form-control" value="{{ agent_transport.return_tr }}" maxlength="15" autocomplete=off>
                        </td>
                        <td><input name="return_to" class="form-control" value="{{ agent_transport.return_to }}" maxlength="20" autocomplete=off></td>

                        <td><input name="container_1" class="form-control" value="{{ agent_transport.container_1 }}" maxlength="20" autocomplete=off></td>
                        <td><input name="container_2" class="form-control" value="{{ agent_transport.container_2 }}" maxlength="20" autocomplete=off></td>

                        <td><input name="ref" class="form-control" value="{{ agent_transport.ref }}" maxlength="150" autocomplete=off></td>
                        <td><textarea class="form-control" rows="1" name="remark" style="padding: 2px 4px; font-size: 12px;" maxlength="200">{{ agent_transport.remark }}</textarea></td>

                        <td class="text-nowrap">{{ agent_transport.work_id }}</td>

                    </tr>
                {% endfor %}
                </form>
            </tbody> 
        </table>
        </div>
        {% else %}
            <h1 class="text-center text-secondary mt-3"> ไม่พบข้อมูล </h1>
        {% endif %}
    <script src="{% static 'js/fixed-header.js' %}"></script>
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="{% static 'js/agent_transport_edit.js' %}"></script>
        
    {% endblock %}
    </body>

</html>